#include <avr/io.h>
#include <util/delay.h>
#include "Interface.h"
#include "Move.h"
#include "Motor.h"
#include "Sensor.h"

// 0번에서는 이어하고 아니면 가감속 넣기
#define aset(x) 	c ? (x) : 0

// 줌 매크로. 원하는 만큼 줌 설정 
#define zoom(x) 	for(int i=0; i<23; i++) Camera_Cmd(1,6); _delay_ms(10); for(int i=0; i<(x); i++) Camera_Cmd(1,5);	_delay_ms(50);

// 우선순위 설정 매크로
#define prior(x)	Camera_Cmd(1,x);	_delay_ms(50);

int c = 0;
extern int dType;	// From move.c



int acc = 0;




////////////////////////////////////DISPLAY///////////////////////////////////////////////////////////////////////////////////////////////////////






////////////////////////////////////DISPLAY///////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////ALGORITHM///////////////////////////////////////////////////////////////////////////////////////////////////////






////////////////////////////////////ALGORITHM///////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////MOVE///////////////////////////////////////////////////////////////////////////////////////////////////////






////////////////////////////////////MOVE///////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////PUCK///////////////////////////////////////////////////////////////////////////////////////////////////////






////////////////////////////////////PUCK///////////////////////////////////////////////////////////////////////////////////////////////////////





int main(void)
{
    Interface_init(); _delay_ms(50); //인터페이스 초기화
	LM629_HW_Reset(); _delay_ms(50);
	MCU_init();	_delay_ms(50);   // MCU 초기화
	Motor_init();  // Motor 드라이버 초기화

	Sensor_init();_delay_ms(50);
	Camera_init();

	zoom(0) 	// 줌 초기화
	prior(1)	// 카메라 우선순위 설정

	OFF
	clear();

	buzz(50)

	while(1)
	{
		// psd 센서 값 표시
		key();

		key_flag = 1;

		// 버튼을 누르면 -> while문 걸림 -> 0.3초 내에 떼면 실행
		if(sw2 || (key_timer > 300 && !(key_timer%20)))
		{
			while(sw2 && (key_timer < 300));
			c--;
		}
		else if(sw3 || (key_timer > 300 && !(key_timer%20)))
		{
			while(sw3 && (key_timer < 300));
			c++;
		}
		else	 key_timer = 0;
		
		// 케이스 범위 지정
		if(c < -5)	c = 40;
		if(c > 40)	c = -5;

		str(1,5,"case : ");
		lcd(1,12,c);
		lcd(2,4,color_x(1));
		lcd(2,8,color_x(2));
		lcd(2,12,color_x(3));

		if(sw1 && !Emergency)
		{
			while(sw1);
			clear();
			lcd(0,17,c);
			key_flag = 0;

			switch(c)
			{
				// MY
				case -5:	//251
				{
					break;
				}
				case -4:	//252
				{

					break;
				}
				case -3:	//253
				{

					break;
				}
				case -2:	//254
				{

					break;
				}
				case -1:	//255
				{
					color_check(1);
					break;
				}
				case 0:
				{

				}
				case 1:
				{

					if(c) break;
				}
				case 2:
				{
					
					if(c) break;
				}
				case 3:
				{
					
					if(c) break;
				}
				case 4:
				{

					if(c) break;
				}
				case 5:
				{

					if(c) break;
				}
				case 6:
				{

					if(c) break;
				}
				case 7:
				{
					
					if(c) break;
				}
				case 8:
				{

					if(c) break;
				}
				case 9:
				{
					
					if(c) break;
				}
				case 10:
				{
					
					if(c) break;
				}
				case 11:
				{
					
					if(c) break;
				}
				case 12:
				{
					
					if(c) break;
				}
				case 13:
				{

					if(c) break;
				}
				case 14:
				{
					

					if(c) break;
				}
				case 15:
				{
					

					if(c) break;
				}
				case 16:
				{

					if(c) break;
				}
				case 17:
				{

					if(c) break;
				}
				case 18:
				{

					if(c) break;
				}
				case 19:
				{

					if(c) break;
				}
				case 20:
				{

					if(c) break;
				}
				case 21:
				{

					if(c) break;
				}
				case 22:
				{

					if(c) break;
				}
				case 23:
				{

					if(c) break;
				}
				case 24:
				{

					if(c) break;
				}
				case 25:
				{

					if(c) break;
				}
				case 26:
				{

					if(c) break;
				}
				case 27:
				{

					if(c) break;
				}
				case 28:
				{

					if(c) break;
				}
				case 29:
				{

					if(c) break;
				}
				case 30:
				{

					if(c) break;
				}
				case 31:
				{

					if(c) break;
				}
				case 32:
				{

					if(c) break;
				}
				case 33:
				{

					if(c) break;
				}
				case 34:
				{

					if(c) break;
				}
				case 35:
				{

					if(c) break;
				}
				case 36:
				{

					if(c) break;
				}
				case 37:
				{

					if(c) break;
				}
				case 38:
				{

					if(c) break;
				}
				case 39:
				{

					if(c) break;
				}
				case 40:
				{

					if(c) break;
				}
			}

		}


	}

}
